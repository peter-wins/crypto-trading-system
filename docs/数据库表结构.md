  ğŸ“Š æ•°æ®åº“è¡¨ç»“æ„å…¨æ™¯åˆ†æ

  1. exchanges (äº¤æ˜“æ‰€è¡¨) - åŸºç¡€é…ç½®è¡¨

  ç”¨é€”: å­˜å‚¨äº¤æ˜“æ‰€è¿æ¥é…ç½®
  å­—æ®µ:
  - id (ä¸»é”®)
  - name (äº¤æ˜“æ‰€åç§°ï¼Œå¦‚ "binance")
  - api_key_encrypted, api_secret_encrypted (åŠ å¯†çš„APIå‡­è¯)
  - testnet (æ˜¯å¦æµ‹è¯•ç½‘)
  - is_active (æ˜¯å¦å¯ç”¨)
  - created_at, updated_at

  å…³ç³»: è¢«å…¶ä»–æ‰€æœ‰è¡¨å¼•ç”¨ (exchange_id å¤–é”®)

  ---
  2. orders (è®¢å•è¡¨) - è®¢å•ç”Ÿå‘½å‘¨æœŸè®°å½•

  ç”¨é€”: è®°å½•æ‰€æœ‰è®¢å•çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸ
  å­—æ®µ:
  - id (ä¸»é”®ï¼Œäº¤æ˜“æ‰€è®¢å•ID)
  - client_order_id (å®¢æˆ·ç«¯è®¢å•ID)
  - exchange_id â†’ exchanges.id
  - symbol (äº¤æ˜“å¯¹)
  - side (buy/sell)
  - type (market/limit/stop_lossç­‰)
  - status (pending/open/filled/canceledç­‰)
  - price, amount, filled, remaining, cost, average
  - fee, fee_currency
  - stop_price, take_profit_price, stop_loss_price
  - decision_id â†’ decisions.id (å…³è”å†³ç­–è®°å½•)
  - timestamp, datetime
  - raw_data (JSONBï¼ŒåŸå§‹äº¤æ˜“æ‰€å“åº”)

  ç´¢å¼•: symbol, status, datetime, exchange_id, decision_id
  çº¦æŸ: side IN ('buy', 'sell'), status, type æšä¸¾

  ç”¨é€”è¯´æ˜:
  âœ… è®°å½•æ¯ä¸€ç¬”è®¢å•çš„æäº¤ã€æˆäº¤ã€å–æ¶ˆå…¨è¿‡ç¨‹
  âœ… é€šè¿‡ decision_id å…³è”åˆ°å†³ç­–è®°å½•
  âœ… åŒ…å«æ­¢æŸæ­¢ç›ˆè®¢å•

  ---
  3. trades (æˆäº¤è®°å½•è¡¨) - è®¢å•æˆäº¤æ˜ç»†

  ç”¨é€”: è®°å½•è®¢å•çš„æ¯ä¸€ç¬”æˆäº¤
  å­—æ®µ:
  - id (ä¸»é”®ï¼Œäº¤æ˜“æ‰€æˆäº¤ID)
  - order_id â†’ orders.id (å…³è”è®¢å•)
  - exchange_id â†’ exchanges.id
  - symbol, side
  - price, amount, cost
  - fee, fee_currency
  - timestamp, datetime
  - raw_data (JSONB)

  å…³ç³»: ä¸€ä¸ªè®¢å•å¯ä»¥æœ‰å¤šç¬”æˆäº¤ (order_id)

  ç”¨é€”è¯´æ˜:
  âœ… è®°å½•è®¢å•çš„éƒ¨åˆ†æˆäº¤å’Œå¤šæ¬¡æˆäº¤
  âœ… ç”¨äºè®¡ç®—å®é™…æˆäº¤å‡ä»·å’Œè´¹ç”¨

  ---
  4. positions (æŒä»“è¡¨) âš ï¸ æ ¸å¿ƒäº‰è®®ç‚¹

  ç”¨é€”: è®°å½•å½“å‰å’Œå†å²æŒä»“
  å­—æ®µ:
  - id (ä¸»é”®ï¼Œè‡ªå¢)
  - exchange_id â†’ exchanges.id
  - symbol
  - side (long/short)
  - amount, entry_price, current_price, value
  - unrealized_pnl, unrealized_pnl_percentage
  - stop_loss, take_profit
  - leverage, liquidation_price
  - is_open (æ˜¯å¦å¼€ä»“çŠ¶æ€) âš ï¸
  - opened_at, updated_at, closed_at

  ç´¢å¼•: symbol, exchange_id, opened_at, is_open

  å½“å‰é€»è¾‘é—®é¢˜:
  âŒ is_open å­—æ®µè®¾è®¡æ··ä¹±ï¼š
     - åŸæ„: åŒºåˆ†"æ´»è·ƒæŒä»“"å’Œ"å†å²æŒä»“"
     - é—®é¢˜: ä»æ¥ä¸ä¼šè®¾ç½®ä¸º False (ç›´åˆ°æˆ‘åˆšæ‰ä¿®å¤)
     - å¯¼è‡´: å¹³ä»“åä»ç„¶æ˜¾ç¤º is_open=True

  âŒ è¡¨å®šä¹‰çš„å”¯ä¸€æ€§é—®é¢˜:
     - ä»£ç æ³¨é‡Šè¯´: "æ¯ä¸ª (exchange_id, symbol, is_open=True) åªèƒ½æœ‰ä¸€æ¡è®°å½•"
     - ä½†æ•°æ®åº“æ²¡æœ‰å”¯ä¸€çº¦æŸï¼
     - å¯èƒ½å¯¼è‡´åŒä¸€symbolçš„å¤šä¸ªå¼€ä»“è®°å½•

  âŒ ä¸ portfolio_snapshots çš„å…³ç³»ä¸æ¸…:
     - positions è¡¨: æŒä»“çš„å†å²å˜æ›´è®°å½•ï¼Ÿ
     - portfolio_snapshots.positions: æŸæ—¶åˆ»çš„æŒä»“å¿«ç…§ï¼Ÿ
     - ä¸¤è€…ç”¨é€”é‡å ï¼

  ---
  5. portfolio_snapshots (æŠ•èµ„ç»„åˆå¿«ç…§è¡¨) âš ï¸ æ ¸å¿ƒäº‰è®®ç‚¹

  ç”¨é€”: å®šæœŸè®°å½•æŠ•èµ„ç»„åˆçŠ¶æ€å¿«ç…§
  å­—æ®µ:
  - id (ä¸»é”®ï¼Œè‡ªå¢)
  - exchange_id â†’ exchanges.id
  - total_value (æ€»èµ„äº§)
  - cash (ç°é‡‘ä½™é¢)
  - positions_value (æŒä»“å¸‚å€¼)
  - total_pnl, daily_pnl, total_return
  - positions (JSONB) âš ï¸ **æŒä»“è¯¦æƒ…æ•°ç»„**
  - snapshot_date (å¿«ç…§æ—¥æœŸ)
  - timestamp, datetime
  - created_at

  ç´¢å¼•: snapshot_date, exchange_id

  positions å­—æ®µæ ¼å¼ (JSONæ•°ç»„):
  [
    {
      "symbol": "BTC/USDT:USDT",
      "side": "long",
      "amount": 0.01,
      "entry_price": 100000.0,
      "current_price": 101000.0,
      "value": 1010.0,
      "pnl": 10.0,
      "pnl_pct": 1.0,
      "leverage": 10,
      "liquidation_price": 90000.0,
      "stop_loss": 98000.0,
      "take_profit": 105000.0
    }
  ]

  å½“å‰é€»è¾‘é—®é¢˜:
  âŒ ä¸ positions è¡¨çš„èŒè´£é‡å ï¼š
     - positions è¡¨: æŒä»“å˜æ›´å†å²
     - portfolio_snapshots.positions: å¿«ç…§æ—¶åˆ»çš„æŒä»“
     - ä¸¤è€…éƒ½å­˜å‚¨æŒä»“ä¿¡æ¯ï¼

  âŒ å¿«ç…§ç²’åº¦é—®é¢˜:
     - æ¯å¤©ä¸€æ¡å¿«ç…§ (snapshot_date å”¯ä¸€)
     - ä½†ä»£ç å¯èƒ½ä¸€å¤©å¤šæ¬¡æ›´æ–°åŒä¸€å¿«ç…§
     - UPSERT å¯¼è‡´è¦†ç›–ï¼Œä¸¢å¤±ä¸­é—´çŠ¶æ€

  âœ… ä¼˜ç‚¹:
     - è½»é‡çº§ï¼ŒæŸ¥è¯¢å¿«
     - åŒ…å«è®¡ç®—åçš„ç›ˆäºæ•°æ®

  ---
  6. decisions (å†³ç­–è®°å½•è¡¨) - å†³ç­–è¿‡ç¨‹è¿½æº¯

  ç”¨é€”: è®°å½•æ¯æ¬¡å†³ç­–çš„è¾“å…¥ã€è¿‡ç¨‹ã€è¾“å‡º
  å­—æ®µ:
  - id (ä¸»é”®)
  - decision_layer (strategic/tactical) - æˆ˜ç•¥å±‚/æˆ˜æœ¯å±‚
  - input_context (JSONB) - å†³ç­–è¾“å…¥ä¸Šä¸‹æ–‡
  - thought_process (Text) - å†³ç­–æ¨ç†è¿‡ç¨‹
  - tools_used (æ•°ç»„) - ä½¿ç”¨çš„å·¥å…·åˆ—è¡¨
  - decision (Text) - å†³ç­–è¾“å‡º
  - action_taken (Text) - é‡‡å–çš„è¡ŒåŠ¨
  - model_used (æ¨¡å‹åç§°)
  - tokens_used, latency_ms
  - timestamp, datetime

  ç´¢å¼•: decision_layer, datetime

  ç”¨é€”è¯´æ˜:
  âœ… æˆ˜ç•¥å±‚å†³ç­–: MarketRegime ç”Ÿæˆè®°å½•
  âœ… æˆ˜æœ¯å±‚å†³ç­–: TradingSignal ç”Ÿæˆè®°å½•
  âœ… ç”¨äºå†³ç­–å®¡è®¡å’Œå›æº¯åˆ†æ

  ---
  7. experiences (äº¤æ˜“ç»éªŒè¡¨) - å­¦ä¹ ä¸åæ€

  ç”¨é€”: è®°å½•äº¤æ˜“ç»éªŒå’Œåæ€ï¼Œç”¨äºRAGæ£€ç´¢
  å­—æ®µ:
  - id (ä¸»é”®)
  - situation (æƒ…å¢ƒæè¿°)
  - situation_tags (æ ‡ç­¾æ•°ç»„ï¼Œç”¨äºæ£€ç´¢)
  - decision, decision_reasoning
  - decision_id â†’ decisions.id
  - outcome (success/failure)
  - pnl, pnl_percentage
  - reflection (åæ€)
  - lessons_learned (æ•™è®­åˆ—è¡¨)
  - importance_score (é‡è¦æ€§è¯„åˆ†)
  - related_orders (å…³è”è®¢å•åˆ—è¡¨)
  - symbol
  - timestamp, datetime

  ç´¢å¼•: outcome, importance_score, datetime, symbol, tags (GIN)

  ç”¨é€”è¯´æ˜:
  âœ… é•¿æœŸè®°å¿†çš„æ ¸å¿ƒ
  âœ… æ”¯æŒå‘é‡æ£€ç´¢ (é…åˆ Qdrant)
  âœ… ç”¨äºå†³ç­–æ—¶çš„ç»éªŒå€Ÿé‰´

  ---
  8. strategies (ç­–ç•¥é…ç½®è¡¨) - ç­–ç•¥å‚æ•°ç®¡ç†

  ç”¨é€”: å­˜å‚¨äº¤æ˜“ç­–ç•¥é…ç½®
  å­—æ®µ:
  - id (ä¸»é”®)
  - name, version, description
  - max_position_size, max_single_trade, max_open_positions
  - max_daily_loss, max_drawdown
  - stop_loss_percentage, take_profit_percentage
  - trading_pairs, timeframes (JSONB)
  - is_active (å½“å‰æ´»è·ƒç­–ç•¥)
  - reason_for_update
  - created_at, updated_at

  ç”¨é€”è¯´æ˜:
  âœ… åŠ¨æ€è°ƒæ•´ç­–ç•¥å‚æ•°
  âœ… æ”¯æŒç­–ç•¥ç‰ˆæœ¬ç®¡ç†
  âœ… å¯ä»¥åŒæ—¶ä¿å­˜å¤šä¸ªç­–ç•¥é…ç½®

  ---
  9. performance_metrics (ç»©æ•ˆæŒ‡æ ‡è¡¨) - ç­–ç•¥è¡¨ç°ç»Ÿè®¡

  ç”¨é€”: è®°å½•ç­–ç•¥ç»©æ•ˆæŒ‡æ ‡
  å­—æ®µ:
  - id (ä¸»é”®)
  - strategy_id â†’ strategies.id
  - start_date, end_date
  - total_return, annualized_return
  - volatility, max_drawdown
  - sharpe_ratio, sortino_ratio, calmar_ratio
  - total_trades, winning_trades, losing_trades
  - win_rate, avg_win, avg_loss, profit_factor
  - max_consecutive_wins, max_consecutive_losses
  - created_at

  ç´¢å¼•: start_date, end_date

  ç”¨é€”è¯´æ˜:
  âœ… å®šæœŸè®¡ç®—ç­–ç•¥ç»©æ•ˆ
  âœ… æ”¯æŒå›æµ‹å’Œå®ç›˜å¯¹æ¯”
  âœ… é£é™©è°ƒæ•´åæ”¶ç›ŠæŒ‡æ ‡

  ---
  10. system_events (ç³»ç»Ÿäº‹ä»¶è¡¨) - ç³»ç»Ÿæ—¥å¿—

  ç”¨é€”: è®°å½•ç³»ç»Ÿé‡è¦äº‹ä»¶å’Œé”™è¯¯
  å­—æ®µ:
  - id (ä¸»é”®)
  - event_type (äº‹ä»¶ç±»å‹)
  - severity (info/warning/error/critical)
  - data (JSONB)
  - related_order_id, related_symbol
  - message, details
  - timestamp, datetime

  ç´¢å¼•: event_type, severity, datetime, order_id

  ç”¨é€”è¯´æ˜:
  âœ… å¼‚å¸¸ç›‘æ§
  âœ… å®¡è®¡æ—¥å¿—
  âœ… æ•…éšœæ’æŸ¥

