  1. 绩效指标（Performance Metrics）

  API端点: /api/performance/metrics (performance.py:109-187)

  数据来源:
  - 当前持仓数据: positions 表（获取未实现盈亏）
    - 第 134 行: positions = await dao.get_open_positions()
    - 计算总收益和收益率（第 143-145 行）
  - 历史快照数据: portfolio_snapshots 表（最近 30 天）
    - 第 135 行: snapshots = await dao.get_portfolio_snapshots(limit=30)
    - 用于计算最大回撤（第 147-157 行）
    - 用于计算夏普比率（第 159-168 行）

  计算的指标:
  - ✅ 总收益/收益率 - 从当前持仓计算
  - ✅ 最大回撤 - 从历史快照计算
  - ✅ 夏普比率 - 从历史快照的日收益率计算
  - ❌ 胜率、交易次数、平均盈亏、盈亏比 - 目前返回 0（第 176-182 行）

  问题: 胜率等交易统计指标需要从 closed_positions 表计算，但目前尚未实现。

  ---
  2. 净值曲线（Equity Curve）

  API端点: /api/performance/equity-curve (performance.py:190-262)

  数据来源:
  - 历史快照数据: portfolio_snapshots 表
    - 第 225-229 行: snapshots = await dao.get_portfolio_snapshots(...)
    - 支持日期范围筛选
    - 最多返回 365 天数据

  数据结构:
  {
    "timestamp": "2025-11-10T08:00:00+00:00",
    "value": 50234.56  # wallet_balance 或 total_value
  }

  备用方案: 如果没有数据，返回模拟数据（第 232-234 行）

  ---
  3. 交易统计（Trades Stats）

  API端点: /api/performance/trades-stats (performance.py:265-296)

  数据来源:
  - ❌ 目前是硬编码的假数据（第 276-292 行）
  - TODO 标记：需要实现真实统计功能（第 275 行）

  应该从哪里获取:
  - 盈亏分布: 从 closed_positions 表的 realized_pnl 字段统计
  - 持仓时长: 从 closed_positions 表的 holding_duration_seconds 字段统计

  ---
  数据流程图

  数据库表
  ├─ positions (当前持仓)
  │   └─ unrealized_pnl → 总收益计算
  │
  ├─ portfolio_snapshots (历史快照)
  │   ├─ total_value → 净值曲线
  │   ├─ wallet_balance → 净值曲线
  │   └─ 日收益率序列 → 最大回撤、夏普比率
  │
  └─ closed_positions (已平仓) ⚠️ 未使用
      ├─ realized_pnl → 应该用于胜率、盈亏比
      └─ holding_duration_seconds → 应该用于持仓时长分布

  ---

    数据来源总结

  | 指标      | 数据来源                                     | 状态     |
  |---------|------------------------------------------|--------|
  | 总收益/收益率 | positions (未实现) + closed_positions (已实现) | ✅ 真实数据 |
  | 最大回撤    | portfolio_snapshots                      | ✅ 真实数据 |
  | 夏普比率    | portfolio_snapshots                      | ✅ 真实数据 |
  | 胜率      | closed_positions                         | ✅ 真实数据 |
  | 交易次数    | closed_positions                         | ✅ 真实数据 |
  | 平均盈利/亏损 | closed_positions                         | ✅ 真实数据 |
  | 盈亏比     | closed_positions                         | ✅ 真实数据 |
  | 净值曲线    | portfolio_snapshots                      | ✅ 真实数据 |
  | 盈亏分布    | closed_positions                         | ✅ 真实数据 |
  | 持仓时长分布  | closed_positions                         | ✅ 真实数据 |