# 战略层 vs. 战术层职责说明

本文统一梳理分层决策系统中两个层级的目标、输入输出以及协同方式，并明确**系统只会分析配置文件中声明的币种**，不会在运行期“推荐”未采集的数据来源。

## 1. 总体逻辑

| 层级 | 决策目标 | 时间跨度 | 主要输入 | 输出结果 | 频率 |
| --- | --- | --- | --- | --- | --- |
| 战略层 Strategic | 识别市场环境、设定风险承受区间、决定是否允许交易 | 中期（1h～1d） | 宏观趋势、波动率、资金费率、市场结构、账户总体暴露 | `market_regime`、`bias`、`risk_budget`、`allow_trading` 等战略指令 | 低频（每 1h～24h） |
| 战术层 Tactical | 在战略约束下做择时、进出场与仓位调整 | 短期（5m～15m） | 价格波动、技术指标、支撑阻力、订单流、当前持仓 | 具体操作：`enter/exit/hold`、仓位、止盈止损 | 高频（每 5～15 分钟） |

## 2. 战略层职责

### 目标

- 识别市场 regime（趋势、震荡、极端波动）。
- 分配风险预算、现金/仓位比例，决定是否暂停战术层（熔断）。
- 限定可交易资产集合、策略风格（趋势/均值回归等）。

### 关键输入（中周期）

- 1h/4h/1d K 线、ATR/HV/VIX 类波动率。
- 资金费率、未平仓量（OI）、市场宽度（BTC Dominance、相关性）。
- 重大新闻、宏观指标（利率、通胀、就业、美元指数）。
- 账户总体暴露、现金占比、历史回撤。

### 典型输出

```json
{
  "market_regime": "trending_up",
  "bias": "long",
  "risk_budget": 0.7,
  "strategy_mode": "trend_follow",
  "allow_trading": true,
  "cash_ratio_target": 0.3,
  "symbol_whitelist": ["BTC/USDT", "ETH/USDT"]
}
```

## 3. 战术层职责

### 目标

- 在战略指令范围内执行进场/平仓/持仓管理。
- 做短期择时，响应支撑阻力、成交量、形态突破等信号。
- 结合当前持仓、杠杆、强平价，生成止盈/止损方案。

### 关键输入（短周期）

- 5m/15m 价格序列、技术指标（EMA 斜率、RSI、MACD、ATR）。
- 战略层下发的 `bias/risk_budget/allow_trading/symbol_whitelist`。
- 当前账户与持仓详情（方向、杠杆、强平价、已有保护单）。
- 订单流、成交量、支撑阻力、局部结构。

### 典型输出

```json
{
  "action": "exit_short",
  "symbol": "ETH/USDT",
  "confidence": 0.86,
  "suggested_amount": 0.6,
  "suggested_price": 3583.1,
  "stop_loss": null,
  "take_profit": null,
  "leverage": null,
  "reasoning": "价格触及前低支撑，战略层 bias=neutral，需落袋"
}
```

## 4. 协同示例

| 战略层状态 | 战术层响应 |
| --- | --- |
| `bias=long`, `risk_budget=0.8`, `allow_trading=true` | 只寻找多头信号，可放宽止盈、适度加仓 |
| `bias=neutral`, `strategy_mode=mean_reversion` | 缩短持仓周期，侧重反弹/回落交易 |
| `allow_trading=false` | 停止开新仓，仅管理已有仓位（平仓/保护单） |
| `bias=long`, `risk_budget=0.5`, `vol_spike=true` | 允许突破单但强制收紧止损、降低杠杆 |

## 5. 币种范围：只分析配置文件声明的资产

- 系统只会采集 `.env` / 配置中声明的交易对（例如 `.env` 的 `DATA_SOURCE_SYMBOLS=BTC/USDT,ETH/USDT`）。
- 数据采集器、指标计算、执行器都围绕这份列表初始化；不支持动态拉取“推荐币种”的行情数据。
- 因此**战略层无需也不应该推荐新的交易对**，避免给战术层下达无法执行的指令。
- 如需扩充资产池，请在配置中显式添加交易对并重启服务，确保数据采集与执行链路完整。

该约束保证了：

1. 数据源、指标、持仓快照始终一致，不会出现“信号涉及未采集资产”的情况。
2. 交易执行器、风险控制器只需要管理有限的、可预先验证的交易对。
3. 部署环境只需为选定的资产准备行情/订单订阅，降低资源消耗。

---

通过上述职责划分与配置约束，战略层可以专注“做或不做、怎么控风险”，战术层专注“怎么做”，而系统整体保持在可观测、可执行的资产范围内稳定运行。
